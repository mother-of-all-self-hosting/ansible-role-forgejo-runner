# SPDX-FileCopyrightText: 2023-2024 Nikita Chernyi
# SPDX-FileCopyrightText: 2023-2025 MASH project contributors
# SPDX-FileCopyrightText: 2023-2025 Slavi Pantaleev
# SPDX-FileCopyrightText: 2024-2025 Sergio Durigan Junior
# SPDX-FileCopyrightText: 2025 Suguru Hirahara
#
# SPDX-License-Identifier: AGPL-3.0-or-later

---
# Project source code URL: https://code.forgejo.org/forgejo/runner

forgejo_runner_enabled: true

forgejo_runner_identifier: forgejo-runner
forgejo_runner_base_path: "/{{ forgejo_runner_identifier }}"
forgejo_runner_config_path: "{{ forgejo_runner_base_path }}/config"

# renovate: datasource=docker depName=code.forgejo.org/forgejo/runner versioning=semver
forgejo_runner_version: 11.3.0

# The image always runs with UID/GID 1000, which causes a permission
# issue when trying to access the Docker socket.  For this reason,
# it's necessary to force the image to run as root.
forgejo_runner_uid: '0'
forgejo_runner_gid: '0'

forgejo_runner_container_image: "{{ forgejo_runner_container_image_registry_prefix }}forgejo/runner:{{ forgejo_runner_container_image_tag }}"
forgejo_runner_container_image_tag: "{{ forgejo_version }}"
forgejo_runner_container_image_registry_prefix: "{{ forgejo_runner_container_image_registry_prefix_upstream }}"
forgejo_runner_container_image_registry_prefix_upstream: "{{ forgejo_runner_container_image_registry_prefix_upstream_default }}"
forgejo_runner_container_image_registry_prefix_upstream_default: code.forgejo.org/
forgejo_runner_container_image_force_pull: "{{ forgejo_runner_container_image.endswith(':latest') }}"

# The base container network. It will be auto-created by this role if it doesn't exist already.
forgejo_runner_container_network: "{{ forgejo_runner_identifier }}"

# A list of additional container networks that the container would be connected to.
# The role does not create these networks, so make sure they already exist.
# Use this to expose this container to another reverse proxy, which runs in a different container network.
forgejo_runner_container_additional_networks: "{{ forgejo_runner_container_additional_networks_auto + forgejo_runner_container_additional_networks_custom }}"
forgejo_runner_container_additional_networks_auto: []
forgejo_runner_container_additional_networks_custom: []

# A list of additional "volumes" to mount in the container.
# This list gets populated dynamically at runtime. You can provide a different default value,
# if you wish to mount your own files into the container.
# Contains definition objects like this: `{"type": "bind", "src": "/outside", "dst": "/inside", "options": "readonly"}.
# See the `--mount` documentation for the `docker run` command.
forgejo_runner_container_additional_volumes: "{{ forgejo_runner_container_additional_volumes_auto + forgejo_runner_container_additional_volumes_custom }}"
forgejo_runner_container_additional_volumes_auto: []
forgejo_runner_container_additional_volumes_custom: []

# List of systemd services that forgejo-runner.service depends on
forgejo_runner_systemd_required_services_list: "{{ forgejo_runner_systemd_required_services_list_default + forgejo_runner_systemd_required_services_list_auto + forgejo_runner_systemd_required_services_list_custom }}"
forgejo_runner_systemd_required_services_list_default: "{{ [devture_systemd_docker_base_docker_service_name] if devture_systemd_docker_base_docker_service_name else [] }}"
forgejo_runner_systemd_required_services_list_auto: []
forgejo_runner_systemd_required_services_list_custom: []

# The runner name.
forgejo_runner_runner_name: ''

# The instance URL.
forgejo_runner_instance_url: ''

# The registration token.
#
# This should be obtained via Forgejo's web interface, under:
#
#   Site Administration -> Actions -> Runners -> Create new runner
forgejo_runner_registration_token: ''

# How many concurrent tasks should be executed simultaneously.
forgejo_runner_capacity: 1

# The labels that should be applied to this runner.
#
# This is an important setting.  Take a look at the following page for
# more information:
#
#  https://forgejo.org/docs/latest/admin/actions/#labels-and-runs-on
forgejo_runner_labels: []

# The valid volumes that are allowed to be mounted by test containers
# spawned by the runner.
#
# For example, if you would like your CI jobs to be able to manipulate
# Docker containers, you can list /var/run/docker.sock here, and then
# specify "-v /var/run/docker:/var/run/docker" as an option when
# launching the CI container.
#
# For more details, see the "valid_volumes" option here:
#
# - https://forgejo.org/docs/latest/admin/runner-installation/#configuration
#
# See also:
#
# - https://forgejo.org/docs/latest/user/actions/#jobsjob_idcontaineroptions
forgejo_runner_allowed_valid_volumes: []

# The Docker endpoint to be used.
forgejo_runner_docker_endpoint_is_unix_socket: true
forgejo_runner_docker_endpoint: unix:///var/run/docker.sock

# Whether to enable caching for CI runs, to save and restore commonly used
# files (built dependencies, assets...)
# For more details see the "Cache configuration" option here:
#
# - https://forgejo.org/docs/latest/admin/actions/runner-installation/#cache-configuration

forgejo_runner_cache_enabled: false
# The port bound by the internal cache server. 0 uses a random available port.
forgejo_runner_cache_port: 0
# The directory (on the container) where to store cache data.
# Map this to a volume for persistent storage.
# If unset, saves the results to $HOME/.cache/actcache.
forgejo_runner_cache_directory: ""
# The host to connect to for caching.
# Leave empty to spawn a server automatically.
# If set, the URL must end with '/'.
forgejo_runner_cache_host: ""

# A list of extra arguments to pass to the container
forgejo_runner_container_extra_arguments: []

# Additional environment variables.
forgejo_runner_environment_variables_additional_variables: ''
